<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHACL Form Editor</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script type="module" src="https://cdn.jsdelivr.net/npm/@ulb-darmstadt/shacl-form/dist/form-bootstrap.js"></script>

    <script type="module">
        const form = document.getElementById("shacl-form");
        const outputPre = document.getElementById('rdf-output');

        // To update the RDF output
        form.addEventListener('submit', event => {
            outputPre.innerText = form.serialize();
            outputPre.style.color = 'green';
        });
        // form.addEventListener('change', event => {
        //     if (event.detail?.valid) {
        //         outputPre.innerText = form.serialize();
        //         outputPre.style.color = 'green';
        //     } else {
        //         outputPre.innerText = 'Invalid data (check constraints)';
        //         outputPre.style.color = 'red';
        //     }
        // });

        // The Toggle Button for full screen
        const toggleBtn = document.getElementById('toggle-view-btn');
        const leftCol = document.getElementById('left-col');
        const rightCol = document.getElementById('right-col');

        toggleBtn.addEventListener('click', () => {
            // If the right column is visible, we hide it
            if (rightCol.style.display !== 'none') {
                // HIDES RIGHT SECTION
                rightCol.style.display = 'none';
                
                // BIGGER LEFT SECTION (8 col -> 12 col)
                leftCol.classList.remove('col-md-8');
                leftCol.classList.add('col-md-12');
                
                // Change text button
                toggleBtn.innerText = "Show output RDF >>";
            } else {
                // SHOW RIGHT SECTION
                rightCol.style.display = 'block';
                
                // REDUCE LEFT SECTION (12 col -> 8 col)
                leftCol.classList.remove('col-md-12');
                leftCol.classList.add('col-md-8');
                
                // Change text button
                toggleBtn.innerText = "Hide output RDF <<";
            }
        });

        // The Export button setting 
        document.getElementById('export-btn').addEventListener('click', () => {
            const triples = form.serialize();
            const link = document.createElement('a');
            link.href = window.URL.createObjectURL(new Blob([triples], { type: "text/turtle" }));
            // Downloads the file
            link.download = 'data.ttl';
            link.click();
        });
    </script>

    <style>
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
    </style>
</head>

<body class="bg-light">

    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">SHACL-form for RML</span>
             <button id="toggle-view-btn" class="btn btn-outline-light btn-sm">
                Hide Preview Panel &lt;&lt;
            </button>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            
            <div id="left-col" class="col-md-8 transition-all">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <!-- Form Title -->
                        <!-- TODO: make it possible to create multiple TriplesMaps or other RML constructs -->
                        <h2 class="card-title mb-4">RML Mappings</h2>
                        
                        <shacl-form 
                            id="shacl-form" 
                            data-shapes-url="rml-shape.ttl"
                            data-shape-subject="http://example.org/mapping/MappingShape"
                            data-submit-button="Save"
                            data-collapse=""
                        >
                        </shacl-form>

                    </div>
                </div>
            </div>

            <div id="right-col" class="col-md-4">
                <div class="sticky-top" style="top: 20px;">
                    
                    <div class="card shadow-sm">
                        <div class="card-header bg-secondary text-white">
                            Generated Turtle (TTL)
                        </div>
                        <div class="card-body">
                            <pre id="rdf-output">Interacting with form...</pre>
                            <!-- The Export Button to download the generated RDF data -->
                            <button id="export-btn" class="btn btn-success w-100 mt-2">
                                Download .ttl
                            </button>
                        </div>
                    </div>

                </div>
            </div>

        </div>
    </div>

</body>
</html>