<!DOCTYPE html>
<html class="mdui-theme-light">
    <head>
        <link rel="stylesheet" href="https://unpkg.com/mdui@2/mdui.css">
        <style>
            body { font-family: roboto; }
            :root, shacl-form { 
                --filter-column-width: 300px;
                --mdui-color-primary-light: 0, 136, 119;
                --mdui-color-primary-dark: 208, 188, 255;
                --mdui-color-background-light: 255, 255, 255;
                --mdui-color-surface-light: 255, 255, 255;
                --mdui-color-surface-container-high: 255, 255, 255;
                --mdui-color-surface-container-highest-light: 245, 245, 245;
            }
            #rdf-output.valid { color: green; }
            #rdf-output.invalid { color: red; }
            fieldset { margin-top: 20px; }
        </style>
        <link href="https://cdn.jsdelivr.net/npm/@fontsource/roboto/400.css" rel="stylesheet">
        <script type="importmap">
            {
              "imports": {
                "@ulb-darmstadt/shacl-form/": "https://cdn.jsdelivr.net/npm/@ulb-darmstadt/shacl-form/dist/",
                "mdui": "https://unpkg.com/mdui@2/mdui.esm.js"
              }
            }
        </script>
        <script type="module">
            import 'mdui'
            import '../src/form-material.js'
        </script>
        <script type="module" defer>
            const form = document.getElementById("shacl-form")
            form.setClassInstanceProvider((clazz) => { 
                if (clazz === 'http://example.org/Material') {
                    return `
                    <http://example.org/steel> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Steel".
                    <http://example.org/wood> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Wood".
                    <http://example.org/alloy> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Alloy".
                    <http://example.org/plaster> a <http://example.org/Material>; <http://www.w3.org/2000/01/rdf-schema#label> "Plaster".
                    `
                }
            })
            form.addEventListener('change', event => {
                const output = document.getElementById('rdf-output');
                if (event.detail?.valid) {
                    output.innerText = form.serialize();
                    output.classList.add('valid');
                    output.classList.remove('invalid');
                } else {
                    output.innerText = 'Invalid data.';
                    output.classList.add('invalid');
                    output.classList.remove('valid');
                }
            });
            document.getElementById('show-rdf-button').addEventListener('click', () => {
                const fieldset = document.getElementById('rdf-output-fieldset');
                fieldset.style.display = fieldset.style.display === 'none' ? 'block' : 'none';
            });
            document.getElementById('export-button').addEventListener('click', () => {
                const triples = form.serialize();
                const link = document.createElement('a');
                link.href = window.URL.createObjectURL(new Blob([triples], { type: "text/turtle" }));
                link.download = 'rml-output.ttl';
                link.click();
            });
        </script>
    </head>
    <body>
        <shacl-form id="shacl-form" data-shapes-url="rml-shape-simple.ttl" data-values-url="rml-data.ttl"></shacl-form>
        <button id="show-rdf-button" class="mdui-btn mdui-btn-raised mdui-color-theme">Show RDF</button>
        <fieldset id="rdf-output-fieldset" style="display: none;">
            <legend>Generated RDF</legend>
            <pre id="rdf-output"></pre>
            <button id="export-button" class="mdui-btn mdui-btn-raised mdui-color-theme-accent">Export RDF</button>
        </fieldset>
    </body>
</html>